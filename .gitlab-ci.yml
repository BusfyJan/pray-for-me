image: node:9.11-alpine

stages:
    - test
    - deploy

test:
    stage: test
    script:
        - export CI=true
        - npm install --unsafe-perm
        - npm test

deploy_development:
    stage: deploy
    environment:
        name: development
    only:
        - development
    script:
        - apk add curl
        - npm install --unsafe-perm
        - npm run deploy:development
        
deploy_production:
    stage: deploy
    environment:
        name: production
    only:
        - master
    script:
        - apk add curl
        - npm install --unsafe-perm
        - npm run deploy:production