image: node:9.11-alpine

stages:
    - test
    - deploy

test:
    stage: test
    script:
        - export CI=true
        - npm install
        - npm test

deploy_development:
    stage: deploy
    environment:
        name: development
    only:
        - development
    script:
        - npm install
        - cd ./functions && npm install
        - cd .. && npm run deploy_development
        
deploy_production:
    stage: deploy
    environment:
        name: production
    only:
        - master
    script:
        - npm install
        - cd ./functions && npm install
        - cd .. && npm run deploy_production